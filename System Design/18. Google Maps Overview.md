We'll design a simple version of Google Maps.

Some facts about Google Maps:

- Started in 2005.
- Provides various services - satellite imagery, street maps, real-time traffic conditions, and route planning.
- By 2021, it had about 1 billion daily active users, ~99% global coverage, and tens of millions of real-time location updates daily.

## Step 1 Understand the problem and establish scope

Sample Q&A between candidate and interviewer:

- **Candidate:** How many daily active users are we dealing with?
- **Interviewer:** 1 billion DAU.
- **Candidate:** What features should we focus on?
- **Interviewer:** Location update, navigation, ETA, map rendering.
- **Candidate:** How large is road data? Do we have access to it?
- **Interviewer:** We obtained road data from various sources; it's terabytes of raw data.
- **Candidate:** Should we take traffic conditions into consideration?
- **Interviewer:** Yes - we should for accurate time estimations.
- **Candidate:** How about different travel modes - walking, biking, driving?
- **Interviewer:** We should support those.
- **Candidate:** How about multi-stop directions?
- **Interviewer:** Let's not focus on that for the interview scope.
- **Candidate:** Business places and photos?
- **Interviewer:** Good question, but no need to consider those here.

We'll focus on three key features: user location updates, navigation service (including ETA), and map rendering.

### Non-functional requirements

- Accuracy - users should not receive incorrect directions.
- Smooth navigation - users should experience fluid map rendering.
- Data and battery usage - the client should use minimal data and battery (critical for mobile devices).
- General availability and scalability requirements.

Ask AI

## Map 101

Before jumping into the design, there are some map-related concepts we should understand.

Ask AI

### Positioning system

The world is approximately a sphere with positions represented by latitude (north/south) and longitude (east/west).

Latitude and longitude together identify geographic locations used by mapping and navigation systems.

![partitioning system](https://nextleet.com/images/partitioning-system.png)

Ask AI

### Going from 3D to 2D

Translating 3D globe coordinates to a 2D plane is called map projection; all projections introduce distortions.

Google Maps uses a variant of the Mercator projection called Web Mercator to balance usability and scale.

![map projections](https://nextleet.com/images/map-projections.png)

Ask AI

### Geocoding

Geocoding converts addresses or place names to geographic coordinates (lat/lng).

Reverse geocoding converts coordinates back to human-readable addresses.

Techniques include interpolation and leveraging GIS datasets that map street networks to coordinates.

Ask AI

### Geohashing

Geohashing encodes geographic areas into strings by recursively subdividing the world into quadrants.

It enables efficient spatial indexing and lookup for nearby tiles or points.

![geohashing](https://nextleet.com/images/geohashing.png)

Ask AI

### Map rendering

Map rendering uses tiling: the world is divided into many small image tiles which the client fetches and stitches together.

Different zoom levels have different tile sets; e.g., zoomed-out views require fewer tiles.

Tiling reduces bandwidth and allows caching via CDNs.

Ask AI

### Road data processing for navigation algorithms

Intersections become nodes and roads become edges in graph representations used for routing.

Routing often uses modified Dijkstra or A* algorithms; the graph size strongly affects performance.

![road representation](https://nextleet.com/images/road-representation.png)

To scale, the world is subdivided into routing tiles that reference neighbors so algorithms can stitch graphs as needed.

![routing tiles](https://nextleet.com/images/routing-tiles.png)

Ask AI

### Back-of-the-envelope estimation

Storage estimates include map tiles (~70PB compressed estimate), metadata (negligible), and routing tiles.

Traffic: 1B DAU with average usage implies very large QPS; conservative batched GPS model yields ~200k QPS and peaks toward 1M QPS.

Ask AI

## Step 2 - Propose High-Level Design and Get Buy-In

![high level design](https://nextleet.com/images/high-level-design.png)

Ask AI

### Location service

Responsible for recording user location updates which are sent every `t` seconds or as batched arrays.

Location streams power traffic analysis, ETA improvement, road closure detection, and analytics.

![location service](https://nextleet.com/images/location-service.png)

Client-side batching reduces chattiness; server-side systems (Cassandra for writes, Kafka for streaming) handle scale.

POST /v1/locations Parameters locs: JSON encoded array of (latitude, longitude, timestamp) tuples.

Ask AI

### Navigation service

Finds routes between origin and destination with accuracy prioritized; slight latency is acceptable.

Example request: `GET /v1/nav?origin=1355+market+street,SF&destination=Disneyland`

Example response payload includes distance, duration, start/end locations, html_instructions, polyline, geocoded_waypoints, and travel_mode.

{
  "distance": {
    "text": "0.2 mi",
    "value": 259
  },
  "duration": {
    "text": "1 min",
    "value": 83
  },
  "end_location": {
    "lat": 37.4038943,
    "lng": -121.9410454
  },
  "html_instructions": "Head <b>northeast</b> on <b>Brandon St</b> toward <b>Lumin Way</b>

Restricted usage road

",
  "polyline": {
    "points": "_fhcFjbhgVuAwDsCal"
  },
  "start_location": {
    "lat": 37.4027165,
    "lng": -121.9435809
  },
  "geocoded_waypoints": [
    {
      "geocoder_status": "OK",
      "partial_match": true,
      "place_id": "ChIJwZNMti1fawwRO2aVVVX2yKg",
      "types": [
        "locality",
        "political"
      ]
    },
    {
      "geocoder_status": "OK",
      "partial_match": true,
      "place_id": "ChIJ3aPgQGtXawwRLYeiBMUi7bM",
      "types": [
        "locality",
        "political"
      ]
    }
  ],
  "travel_mode": "DRIVING"
}

Ask AI

### Map rendering

Precompute static map tiles per geohash and serve via CDN to minimize latency and enable caching.

Alternate optimization: serve vector tile data (paths & polygons) so clients render dynamically and save bandwidth.

![static map tiles](https://nextleet.com/images/static-map-tiles.png)

Ask AI

## Step 3 - Design Deep Dive

Detailed data models and service internals for routing tiles, location data, geocoding DB, and rendering.

Ask AI

### Routing tiles

Raw road data is processed offline into graph-based routing tiles, stored as compressed binary objects in S3 (or equivalent object storage) and cached aggressively.

Libraries compress adjacency lists; tiles reference neighbors to enable stitching during route computation.

Ask AI

### User location data

Write-heavy time-series location data suits Cassandra for high-throughput writes and range queries per user.

Rows are keyed by `user_id` (partition key) with `timestamp` as clustering key to keep updates time-ordered.

![user location row](https://nextleet.com/images/user-location-data-torw.png)

Ask AI

### Geocoding database

Key-value store mapping lat/lng to place metadata; Redis is suitable for low-latency reads with infrequent writes.

Ask AI

### Precomputed images of the world

Precompute map tiles per zoom level and push to CDN POPs for fast delivery; store originals in object storage with cache control headers.

![precomputed map tile](https://nextleet.com/images/precomputed-map-tile-image.png)

Ask AI

### Location service deep dive

Client batches location points and posts to `/v1/locations`; server writes to Cassandra and publishes to Kafka for downstream consumers.

This supports real-time traffic aggregation, ETA improvements, and analytics pipelines.

![location service diagram](https://nextleet.com/images/location-service-diagram.png)

Ask AI

### Rendering map deep dive

Tiles stored by zoom-level and geohash; clients fetch only required tiles. Vector tiles reduce bandwidth by sending shapes not pixels.

CDN distribution and client-side caching are essential to scale.

![zoom levels](https://nextleet.com/images/zoom-level-increases.png)

Ask AI

### Navigation service deep dive

Geocoding service converts addresses to lat/lng; route planner uses shortest-path (A* variants) on routing tiles to propose paths.

ETA service provides ML-driven time estimates; ranker filters/ranks candidate routes; updater maintains offline datasets asynchronously.

![shortest path service](https://nextleet.com/images/shortest-path-service.png)

https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA

Ask AI

### Improvement - adaptive ETA and rerouting

Track users currently navigating as sequences of routing tiles so incidents on a tile can identify affected users for rerouting.

Store multi-resolution tile references (origin, super-tiles) to compress storage and speed lookups.

user_1: r_1, r_2, r_3, ..., r_k

![adaptive eta data storage](https://nextleet.com/images/adaptive-eta-data-storage.png)

Ask AI

### Delivery protocols

To push data proactively to clients: mobile pushes are limited; WebSocket is preferred for bi-directional low-footprint comms; SSE is an alternative for unidirectional streaming.

- Mobile push notifications - limited payload and not ideal for web.
- WebSocket - general recommendation for real-time two-way communication.
- SSE - useful for simple server-to-client streaming where WebSocket is unnecessary.

Ask AI

## Step 4 - Wrap Up

Final design combines precomputed tiles, routing tiles, location streaming, and a navigation stack with ETA, ranker, and updater services.

Optional enterprise feature: multi-stop navigation for route optimization across multiple locations (valuable to delivery and rideshare customers).

![final design](https://nextleet.com/images/final-design.png)